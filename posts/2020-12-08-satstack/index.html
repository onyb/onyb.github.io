<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Personal sovereignty with Ledger SatStack | Anirudha Bose</title><link rel=canonical href=https://anirudha.co/posts/2020-12-08-satstack/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Personal sovereignty with Ledger SatStack"><meta property="og:description" content="üìù This article is a cross-post from the Ledger Engineering blog.
Bitcoin is a technological breakthrough. It&rsquo;s not just money over TCP/IP, but also something that comes with total and unrestricted ownership, making it a very robust store of value. Back in 2014, we released the first ever smartcard-based Bitcoin hardware wallet named BTChip HW.1. Ledger has come a long way since, but our core ideas have not changed ‚Äî we want to bring Bitcoin to the masses, and help you secure your keys like your life depends on it."><meta property="og:type" content="article"><meta property="og:url" content="https://anirudha.co/posts/2020-12-08-satstack/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-12-08T00:00:00+00:00"><meta property="article:modified_time" content="2020-12-08T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Personal sovereignty with Ledger SatStack"><meta name=twitter:description content="üìù This article is a cross-post from the Ledger Engineering blog.
Bitcoin is a technological breakthrough. It&rsquo;s not just money over TCP/IP, but also something that comes with total and unrestricted ownership, making it a very robust store of value. Back in 2014, we released the first ever smartcard-based Bitcoin hardware wallet named BTChip HW.1. Ledger has come a long way since, but our core ideas have not changed ‚Äî we want to bring Bitcoin to the masses, and help you secure your keys like your life depends on it."><link rel=stylesheet href=https://anirudha.co/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://anirudha.co/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&text=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&title=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&is_video=false&description=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Personal%20sovereignty%20with%20Ledger%20SatStack&body=Check out this article: https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&title=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&title=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&name=Personal%20sovereignty%20with%20Ledger%20SatStack&description=%f0%9f%93%9d%20This%20article%20is%20a%20cross-post%20from%20the%20Ledger%20Engineering%20blog.%0aBitcoin%20is%20a%20technological%20breakthrough.%20It%26rsquo%3bs%20not%20just%20money%20over%20TCP%2fIP%2c%20but%20also%20something%20that%20comes%20with%20total%20and%20unrestricted%20ownership%2c%20making%20it%20a%20very%20robust%20store%20of%20value.%20Back%20in%202014%2c%20we%20released%20the%20first%20ever%20smartcard-based%20Bitcoin%20hardware%20wallet%20named%20BTChip%20HW.1.%20Ledger%20has%20come%20a%20long%20way%20since%2c%20but%20our%20core%20ideas%20have%20not%20changed%20%e2%80%94%20we%20want%20to%20bring%20Bitcoin%20to%20the%20masses%2c%20and%20help%20you%20secure%20your%20keys%20like%20your%20life%20depends%20on%20it." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&t=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Personal sovereignty with Ledger SatStack</h1><div class=meta><div class=postdate><time datetime="2020-12-08 00:00:00 +0000 UTC" itemprop=datePublished>2020-12-08</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/bitcoin rel=tag>bitcoin</a></div></div></header><div id=toc><nav id=TableOfContents><ul><li><a href=#what-is-a-full-node>What is a full node?</a></li><li><a href=#why-you-should-consider-running-a-full-node>Why you should consider running a full node</a><ul><li><a href=#dont-trust-verify>Don&rsquo;t trust, verify.</a></li><li><a href=#privacy>Privacy</a></li><li><a href=#independence>Independence</a></li></ul></li><li><a href=#ledger-blockchain-explorer>Ledger Blockchain Explorer</a></li><li><a href=#how-satstack-works>How SatStack works</a></li><li><a href=#under-the-hood>Under the hood</a></li><li><a href=#contributions-and-final-thoughts>Contributions and Final Thoughts</a></li></ul></nav></div><div class=content itemprop=articleBody><p>üìù <em>This article is a cross-post from the <a href=https://blog.ledger.com/satstack>Ledger Engineering blog</a>.</em></p><br><figure class=image><img src=/assets/satstack/logo.jpg></figure><br><p>Bitcoin is a technological breakthrough. It&rsquo;s not just money over TCP/IP, but also something that comes with total and unrestricted ownership, making it a very robust store of value. Back in 2014, we released the first ever smartcard-based Bitcoin hardware wallet named <a href=http://btchip.com>BTChip HW.1</a>. Ledger has come a long way since, but our core ideas have not changed ‚Äî we want to bring Bitcoin to the masses, and help you secure your keys like your life depends on it. Needless to say, Bitcoin is something that cuts close to our mission and values.</p><p>In September this year, we gave our Bitcoin users the possibility to choose which coins are selected for spending in an outgoing transaction, with <a href=https://support.ledger.com/hc/en-us/articles/360015996580-Using-Coin-control>Coin Control</a>. This powerful feature received a lot of love from our Bitcoin community because it allowed them to avoid leaking their privacy to surveillance companies, since Bitcoins are not perfectly fungible.</p><p>Today, we are taking it up a notch. We&rsquo;re giving you the ability to connect Ledger Live to your personal Bitcoin full node, for maximum privacy and trustlessness. We&rsquo;re calling it <a href=https://github.com/LedgerHQ/satstack><strong>SatStack</strong></a>.</p><br><center><figure class=image><img src=/assets/satstack/console.png><br><figcaption>A screenshot of SatStack launching.</figcaption></figure></center><br><h2 id=what-is-a-full-node>What is a full node?</h2><p>A full node, or fully validating node, maintains a full copy of the Bitcoin blockchain and checks it against Bitcoin‚Äôs consensus rules. It independently and unfailingly verifies every transaction registered on the blockchain, by authoritatively reconciling with its copy. A major disagreement in the consensus rules among the full nodes will result in a hard fork. Some of the consensus rules checked by full nodes are:</p><ul><li>cryptographic signatures of transactions are valid.</li><li>there is no unusual inflation in the block subsidy.</li><li>transaction outputs are not double spent.</li></ul><p>Full nodes also play a crucial role in keeping the network healthy by propagating blocks through the Bitcoin p2p network and assigning ban scores to peers that misbehave or attempt to spam the network with invalid transactions. Blocks that violate the consensus rules, or have been orphaned, are not forwarded to the connected peers, effectively forming a shield and preventing peers from wasting compute resources to process invalid blocks. This ability to self-heal and rapidly prune errors is what makes the Bitcoin network extremely antifragile and resistant to DoS attacks.</p><br><center><figure class=image><img src=/assets/satstack/raspiblitz.jpg><br><figcaption>Raspiblitz ‚Äî a DIY Bitcoin full node running on a Raspberry Pi.</figcaption></figure></center><br><h2 id=why-you-should-consider-running-a-full-node>Why you should consider running a full node</h2><h3 id=dont-trust-verify>Don&rsquo;t trust, verify.</h3><p>Bitcoin is a monetary good that eliminates trust. Relying on a remote server for querying your balances and transactions is, therefore, a trust failure. A wallet that&rsquo;s not using a full node will blindly trust just about anything. While a pwned explorer cannot get the private keys on your hardware wallet, or do transactions on your behalf, it can still trick you into believing a completely different state of the blockchain and your wallet, like balances, UTXOs, transaction history, and confirmations. This has security consequences because the compromised explorer server could lie by omission, or be used to trick a user into exchanging real goods or services for fake Bitcoins.</p><p>Luckily, the trusted display on your Ledger hardware wallet is the ultimate line of defence against signing something that has been spoofed by a malicious explorer. What you see is what you sign.</p><h3 id=privacy>Privacy</h3><p>There is a theoretical case to be made that third-party explorers can spy on users&rsquo; transactions, lie about their balances, or even censor certain addresses from using their services. This is the principal reason why Ledger runs its own Bitcoin nodes and has developed in-house indexer and explorer services, despite having cheaper alternatives. Delegating this job to third-party services would expose our users to the risk of on-chain surveillance.</p><p>Running a full node avoids leaking your privacy, and protects you from censorship and surveillance.</p><h3 id=independence>Independence</h3><p>Until today, Ledger&rsquo;s cloud infrastructure has been indispensable, and critical to the functioning of Ledger Live. Running a full node will allow our users to continue using Ledger Live even if the company shuts down its servers or ceases to exist. This is a powerful statement in itself ‚Äî much like being able to access your emails even if Gmail is down.</p><br><center><blockquote class=twitter-tweet><p lang=en dir=ltr>Running bitcoin</p>&mdash; halfin (@halfin) <a href="https://twitter.com/halfin/status/1110302988?ref_src=twsrc%5Etfw">January 11, 2009</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><figcaption>The most timeless tweet in the history of Bitcoin.</figcaption></center><br><h2 id=ledger-blockchain-explorer>Ledger Blockchain Explorer</h2><p>Before diving into SatStack, it&rsquo;s important to have a clear picture of what it intends to replace ‚Äî Ledger&rsquo;s cloud-based blockchain explorers. An explorer is simply a service that allows querying addresses to get associated transactions.</p><center><figure class=image><img src=/assets/satstack/explorer.png style=width:480px></figure></center><br><p>Unlike most third-part services, Ledger&rsquo;s explorers do <strong>NOT</strong> require you to send your account <code>xPub</code> to its remote server. With your <code>xPub</code>, anyone can track all past and future transactions of your account, thereby leaking your privacy. Instead, Ledger Live locally derives individual addresses and uses them to query the associated transactions.</p><br><center><figure class=image><img src=/assets/satstack/ledger_explorer.svg style=width:720px><br><figcaption>Architecture of Ledger Blockchain Explorer.</figcaption></figure></center><br><p>In the above picture, there are two important things to note:</p><ul><li>private keys <strong>never</strong> leave your hardware wallet (in red).</li><li>extended public keys <strong>never</strong> leave Ledger Live (in yellow).</li></ul><h2 id=how-satstack-works>How SatStack works</h2><p>At its core, SatStack is a lightweight blockchain explorer that allows querying the transaction history of addresses.</p><p>Most hosted explorers, including general purpose Electrum servers, achieve this by building an address-to-transactions mapping of the entire blockchain. While this is well suited for most use-cases, it is also extremely resource-hungry and something regular users cannot easily run on their own machines.</p><p>SatStack takes a different approach. It is completely stateless, consumes merely a few megabytes of RAM, and does not require any additional disk space. This is made possible by importing the public wallet descriptors of the user&rsquo;s accounts into the Bitcoin full node&rsquo;s native wallet, and watching for any new transactions on the associated addresses. It follows the model of personal wallet indexers, first popularized by <a href=https://github.com/chris-belcher/electrum-personal-server>Electrum Personal Server</a>.</p><p>We developed SatStack to act as a bridge between Ledger Live and a Bitcoin Core full node. It exposes a REST API to Ledger Live on one side, and communicates with the Bitcoin Core node over RPC on the other side.</p><br><center><figure class=image><img src=/assets/satstack/architecture.svg style=width:720px><br><figcaption>Architecture of Ledger SatStack.</figcaption></figure></center><br>One of the design decisions was to develop SatStack as an independent and standalone binary. This allows for a future possibility to do the things like:
- connect Ledger Live mobile app with a full node.
- locally serve an explorer frontend for even better privacy.
- integrate various protocol extensions.<h2 id=under-the-hood>Under the hood</h2><p>Choosing the right language for this project was critical for a successful execution. We used the following checklist for deciding the programming language to use:</p><ul><li>How easy is to learn, and get productive with it?</li><li>Is there a mature Bitcoin library that provides a rich RPC client, and wire protocol implementation?</li><li>Can it provide high performance, with low memory footprint, without any intritcate optimizations?</li><li>Can it produce small binaries that target a wide range of operating systems?</li></ul><p>We settled with the choice of using Go, although Rust was a close second. SatStack uses <a href=https://github.com/btcsuite>btcsuite</a> libraries, and heavily relies on the transport layer, data structures, and wire protocol parser of <a href=https://github.com/btcsuite/btcd>btcd</a>.</p><p>One of the challenges of building a personal wallet indexer is that non-wallet addresses cannot be tracked by the full node, often resulting in missing information in the transaction history. While this is not a problem if <code>txindex</code> is enabled on Bitcoin Core, it was important for us to build a solution that does not explicitly rely on specialized full node features, in order to accomodate all kinds of full nodes.</p><p>Something else we had to keep in mind was performance, to have fast synchronization on Ledger Live. Much of it was solved by caching UTXOs, and natively decoding <a href=https://en.bitcoin.it/wiki/Protocol_documentation>wire</a> transactions instead of relying on the full node. Performance of SatStack is currently comparable to that of a third-party hosted explorer, which makes it a very attractive alternative. This is a moving target, and we plan on further reducing the RPC overhead on SatStack. Performance benchmarks comparing SatStack and Ledger&rsquo;s cloud explorers are available <a href=https://github.com/LedgerHQ/satstack/blob/master/docs/benchmark.md>here</a>.</p><h2 id=contributions-and-final-thoughts>Contributions and Final Thoughts</h2><ul><li>Starting Ledger Live <a href=https://github.com/LedgerHQ/ledger-live-desktop/releases/tag/v2.18.0>2.18.0</a>, users have the option to use a personal Bitcoin full node, instead of relying on Ledger&rsquo;s infrastructure.</li><li>We designed our solution to be lightweight in terms of CPU and memory usage, with no additional requirements on disk space.</li><li>We contributed several patches to the <a href=https://github.com/btcsuite/btcd>btcd</a> project and will keep doing more in the future.</li><li>We will continue to iterate on SatStack; adding new features, and improving its performance and user-friendliness.</li><li>We hope to see members of our community become sovereign individuals and contribute to the decentralization of the Bitcoin network.</li></ul><p>As Captain Planet likes to say ‚Äî the power is yours.</p></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&text=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&title=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&is_video=false&description=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Personal%20sovereignty%20with%20Ledger%20SatStack&body=Check out this article: https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&title=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&title=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&name=Personal%20sovereignty%20with%20Ledger%20SatStack&description=%f0%9f%93%9d%20This%20article%20is%20a%20cross-post%20from%20the%20Ledger%20Engineering%20blog.%0aBitcoin%20is%20a%20technological%20breakthrough.%20It%26rsquo%3bs%20not%20just%20money%20over%20TCP%2fIP%2c%20but%20also%20something%20that%20comes%20with%20total%20and%20unrestricted%20ownership%2c%20making%20it%20a%20very%20robust%20store%20of%20value.%20Back%20in%202014%2c%20we%20released%20the%20first%20ever%20smartcard-based%20Bitcoin%20hardware%20wallet%20named%20BTChip%20HW.1.%20Ledger%20has%20come%20a%20long%20way%20since%2c%20but%20our%20core%20ideas%20have%20not%20changed%20%e2%80%94%20we%20want%20to%20bring%20Bitcoin%20to%20the%20masses%2c%20and%20help%20you%20secure%20your%20keys%20like%20your%20life%20depends%20on%20it." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fanirudha.co%2fposts%2f2020-12-08-satstack%2f&t=Personal%20sovereignty%20with%20Ledger%20SatStack" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 Anirudha Bose</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script></html>